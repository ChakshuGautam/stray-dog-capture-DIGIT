# DA-03: View Teacher Participation Rate by Block

[â† Back to User Stories Master](../../design-outputs/02-user-stories.md) | [â† Back to Admin Stories](./index.md)

## User Story

**As a** District Administrator,
**I want to** see teacher participation rate by block,
**So that** I can identify underperforming areas that need attention.

## Description

Understanding teacher participation at the block level helps district administrators:
- Identify blocks with low engagement
- Target outreach and training efforts
- Ensure equitable program distribution
- Track adoption progress over time

## Acceptance Criteria

### Functional Requirements
- [ ] Map view showing participation rates by block
- [ ] Table view with detailed block metrics
- [ ] Participation rate = (Active Teachers / Total Teachers) Ã— 100
- [ ] Filter by date range
- [ ] Sort by participation rate, total teachers, submissions
- [ ] Drill-down into block details
- [ ] Comparison with district average

### Non-Functional Requirements
- [ ] Data updated daily
- [ ] Export for reporting
- [ ] Color-coded visualization

## UI/UX Design

### Participation Rate Dashboard
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ“Š Teacher Participation by Block               Last 30 Days   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  District Average: 34% participation (1,245 of 3,680 teachers) â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     BLOCK MAP VIEW                         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                             â”‚â”‚
â”‚  â”‚      â”‚ 45%   â”‚ Patna City                                  â”‚â”‚
â”‚  â”‚      â”‚ â–ˆâ–ˆâ–ˆâ–ˆ  â”‚                                             â”‚â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚â”‚
â”‚  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                  â”‚â”‚
â”‚  â”‚                  â”‚ 38%   â”‚ Danapur                         â”‚â”‚
â”‚  â”‚                  â”‚ â–ˆâ–ˆâ–ˆ   â”‚                                  â”‚â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                    â”‚â”‚
â”‚  â”‚   â”‚ 28%   â”‚ Phulwari          â”‚ 22%   â”‚ Sampatchak        â”‚â”‚
â”‚  â”‚   â”‚ â–ˆâ–ˆ    â”‚                   â”‚ â–ˆâ–ˆ    â”‚ (Low)              â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Legend:  â–ˆâ–ˆâ–ˆâ–ˆ >40%   â–ˆâ–ˆâ–ˆ 30-40%   â–ˆâ–ˆ 20-30%   â–ˆ <20%     â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ðŸ“‹ Block Details                          [Sort: Rate â–¼]  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚ Block        â”‚ Total   â”‚ Active â”‚ Rate    â”‚ Subs   â”‚ Trendâ”‚â”‚â”‚
â”‚  â”‚              â”‚Teachers â”‚Teachersâ”‚         â”‚        â”‚      â”‚â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤â”‚â”‚
â”‚  â”‚ Patna City   â”‚   890   â”‚  401   â”‚  45%    â”‚  423   â”‚ â†‘5%  â”‚â”‚â”‚
â”‚  â”‚ Danapur      â”‚   720   â”‚  274   â”‚  38%    â”‚  298   â”‚ â†‘3%  â”‚â”‚â”‚
â”‚  â”‚ Phulwari     â”‚   650   â”‚  182   â”‚  28%    â”‚  187   â”‚ â†“2%  â”‚â”‚â”‚
â”‚  â”‚ Sampatchak   â”‚   580   â”‚  128   â”‚  22%    â”‚  156   â”‚ â†‘1%  â”‚â”‚â”‚
â”‚  â”‚ Maner        â”‚   420   â”‚  105   â”‚  25%    â”‚  112   â”‚ â†‘4%  â”‚â”‚â”‚
â”‚  â”‚ Bikram       â”‚   420   â”‚  155   â”‚  37%    â”‚  169   â”‚ â†‘6%  â”‚â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  âš  Low Participation Alerts                                â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Sampatchak: 22% participation (580 teachers)              â”‚â”‚
â”‚  â”‚  â€¢ 12% below district average                              â”‚â”‚
â”‚  â”‚  â€¢ Recommend: Awareness campaign, teacher training         â”‚â”‚
â”‚  â”‚  [View Block Details] [Schedule Outreach]                  â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚                                        [Export Report] [Share] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technical Implementation

### Participation Service
```javascript
// src/services/admin/ParticipationService.js

class ParticipationService {
  static PARTICIPATION_THRESHOLDS = {
    HIGH: 40,      // > 40%
    MEDIUM: 30,    // 30-40%
    LOW: 20,       // 20-30%
    CRITICAL: 0    // < 20%
  };

  static async getBlockParticipation(districtId, startDate, endDate) {
    const params = new URLSearchParams({
      districtId,
      startDate: startDate.toISOString(),
      endDate: endDate.toISOString()
    });

    const response = await fetch(`/api/admin/participation/by-block?${params}`);
    return response.json();
  }

  static async getDistrictSummary(districtId, startDate, endDate) {
    const params = new URLSearchParams({
      districtId,
      startDate: startDate.toISOString(),
      endDate: endDate.toISOString()
    });

    const response = await fetch(`/api/admin/participation/summary?${params}`);
    return response.json();
  }

  static calculateParticipationRate(activeTeachers, totalTeachers) {
    if (totalTeachers === 0) return 0;
    return Math.round((activeTeachers / totalTeachers) * 100);
  }

  static getParticipationLevel(rate) {
    if (rate >= this.PARTICIPATION_THRESHOLDS.HIGH) return 'high';
    if (rate >= this.PARTICIPATION_THRESHOLDS.MEDIUM) return 'medium';
    if (rate >= this.PARTICIPATION_THRESHOLDS.LOW) return 'low';
    return 'critical';
  }

  static getParticipationColor(level) {
    const colors = {
      high: '#4caf50',
      medium: '#8bc34a',
      low: '#ff9800',
      critical: '#f44336'
    };
    return colors[level] || '#9e9e9e';
  }

  static getLowParticipationBlocks(blocks, threshold = 25) {
    return blocks.filter(block => block.participationRate < threshold);
  }
}

export default ParticipationService;
```

### Participation Dashboard Component
```jsx
// src/components/admin/ParticipationDashboard.jsx
import React, { useState, useEffect } from 'react';
import ParticipationService from '../../services/admin/ParticipationService';

function ParticipationDashboard({ districtId }) {
  const [dateRange, setDateRange] = useState({ start: getLastMonthStart(), end: new Date() });
  const [districtSummary, setDistrictSummary] = useState(null);
  const [blockData, setBlockData] = useState([]);
  const [sortBy, setSortBy] = useState('rate');
  const [sortOrder, setSortOrder] = useState('desc');
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, [districtId, dateRange]);

  const fetchData = async () => {
    setLoading(true);
    try {
      const [summary, blocks] = await Promise.all([
        ParticipationService.getDistrictSummary(districtId, dateRange.start, dateRange.end),
        ParticipationService.getBlockParticipation(districtId, dateRange.start, dateRange.end)
      ]);

      setDistrictSummary(summary);
      setBlockData(blocks);
    } catch (error) {
      console.error('Failed to fetch participation data:', error);
    } finally {
      setLoading(false);
    }
  };

  const sortedBlocks = [...blockData].sort((a, b) => {
    let aVal, bVal;
    switch (sortBy) {
      case 'rate':
        aVal = a.participationRate;
        bVal = b.participationRate;
        break;
      case 'total':
        aVal = a.totalTeachers;
        bVal = b.totalTeachers;
        break;
      case 'active':
        aVal = a.activeTeachers;
        bVal = b.activeTeachers;
        break;
      case 'submissions':
        aVal = a.submissions;
        bVal = b.submissions;
        break;
      default:
        aVal = a.participationRate;
        bVal = b.participationRate;
    }
    return sortOrder === 'desc' ? bVal - aVal : aVal - bVal;
  });

  const lowParticipationBlocks = ParticipationService.getLowParticipationBlocks(blockData, 25);

  if (loading) {
    return <div className="loading-spinner">Loading participation data...</div>;
  }

  return (
    <div className="participation-dashboard">
      <h2>ðŸ“Š Teacher Participation by Block</h2>

      {/* District Summary */}
      {districtSummary && (
        <div className="district-summary">
          <p>
            District Average: <strong>{districtSummary.participationRate}%</strong> participation
            ({districtSummary.activeTeachers.toLocaleString()} of {districtSummary.totalTeachers.toLocaleString()} teachers)
          </p>
          <div className="progress-bar">
            <div
              className="progress-fill"
              style={{
                width: `${districtSummary.participationRate}%`,
                background: ParticipationService.getParticipationColor(
                  ParticipationService.getParticipationLevel(districtSummary.participationRate)
                )
              }}
            />
          </div>
        </div>
      )}

      {/* Block Map (simplified visualization) */}
      <div className="block-map">
        <h3>Block Overview</h3>
        <div className="map-grid">
          {blockData.map(block => {
            const level = ParticipationService.getParticipationLevel(block.participationRate);
            return (
              <div
                key={block.id}
                className={`map-block ${level}`}
                style={{ borderColor: ParticipationService.getParticipationColor(level) }}
              >
                <div className="block-name">{block.name}</div>
                <div className="block-rate">{block.participationRate}%</div>
              </div>
            );
          })}
        </div>
        <div className="map-legend">
          <span className="legend-item high">â–ˆâ–ˆâ–ˆâ–ˆ &gt;40%</span>
          <span className="legend-item medium">â–ˆâ–ˆâ–ˆ 30-40%</span>
          <span className="legend-item low">â–ˆâ–ˆ 20-30%</span>
          <span className="legend-item critical">â–ˆ &lt;20%</span>
        </div>
      </div>

      {/* Block Details Table */}
      <div className="block-table">
        <div className="table-header">
          <h3>ðŸ“‹ Block Details</h3>
          <select
            value={`${sortBy}-${sortOrder}`}
            onChange={(e) => {
              const [by, order] = e.target.value.split('-');
              setSortBy(by);
              setSortOrder(order);
            }}
          >
            <option value="rate-desc">Highest Rate</option>
            <option value="rate-asc">Lowest Rate</option>
            <option value="total-desc">Most Teachers</option>
            <option value="submissions-desc">Most Submissions</option>
          </select>
        </div>

        <table>
          <thead>
            <tr>
              <th>Block</th>
              <th>Total Teachers</th>
              <th>Active Teachers</th>
              <th>Rate</th>
              <th>Submissions</th>
              <th>Trend</th>
            </tr>
          </thead>
          <tbody>
            {sortedBlocks.map(block => {
              const level = ParticipationService.getParticipationLevel(block.participationRate);
              return (
                <tr key={block.id} className={level}>
                  <td>{block.name}</td>
                  <td>{block.totalTeachers.toLocaleString()}</td>
                  <td>{block.activeTeachers.toLocaleString()}</td>
                  <td>
                    <span className={`rate-badge ${level}`}>
                      {block.participationRate}%
                    </span>
                  </td>
                  <td>{block.submissions.toLocaleString()}</td>
                  <td>
                    <span className={`trend ${block.trend >= 0 ? 'positive' : 'negative'}`}>
                      {block.trend >= 0 ? 'â†‘' : 'â†“'}{Math.abs(block.trend)}%
                    </span>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>

      {/* Low Participation Alerts */}
      {lowParticipationBlocks.length > 0 && (
        <div className="alerts-section">
          <h3>âš  Low Participation Alerts</h3>
          {lowParticipationBlocks.map(block => (
            <div key={block.id} className="alert-card">
              <div className="alert-header">
                <strong>{block.name}</strong>: {block.participationRate}% participation
                ({block.totalTeachers} teachers)
              </div>
              <div className="alert-detail">
                â€¢ {districtSummary.participationRate - block.participationRate}% below district average
              </div>
              <div className="alert-recommendation">
                â€¢ Recommend: Awareness campaign, teacher training
              </div>
              <div className="alert-actions">
                <button className="btn-secondary">View Block Details</button>
                <button className="btn-primary">Schedule Outreach</button>
              </div>
            </div>
          ))}
        </div>
      )}

      <div className="dashboard-actions">
        <button className="export-btn">Export Report</button>
        <button className="share-btn">Share</button>
      </div>
    </div>
  );
}

function getLastMonthStart() {
  const date = new Date();
  date.setDate(date.getDate() - 30);
  return date;
}

export default ParticipationDashboard;
```

## Dependencies

- **egov-user**: Teacher count by block (HRMS integration)
- **Incident API**: Active teacher identification

## Related Stories

- [DA-01](./DA-01.md) - Submission Volume Trends
- [DA-04](./DA-04.md) - Leaderboard
- [SA-02](../state-admin/SA-02.md) - Compare Districts

## Notes

- "Active teacher" = submitted at least 1 report in the period
- Low participation blocks should trigger outreach
- Integration with HRMS for accurate teacher counts
