# DA-07: Export Reports

[‚Üê Back to User Stories Master](../../design-outputs/02-user-stories.md) | [‚Üê Back to Admin Stories](./index.md)

## User Story

**As a** District Administrator,
**I want to** export reports as PDF/CSV,
**So that** I can share them in meetings and offline contexts.

## Description

Export functionality allows administrators to:
- Share data with stakeholders without system access
- Present in meetings and reviews
- Archive historical reports
- Integrate with other systems

## Acceptance Criteria

### Functional Requirements
- [ ] Export as PDF (formatted report)
- [ ] Export as CSV (raw data)
- [ ] Export as Excel (formatted tables)
- [ ] Select date range for export
- [ ] Select metrics to include
- [ ] Include charts in PDF export
- [ ] Scheduled exports (weekly/monthly)
- [ ] Email delivery option

### Non-Functional Requirements
- [ ] PDF generation < 30 seconds
- [ ] CSV download immediate
- [ ] Maximum 10,000 rows per export
- [ ] Exports logged for audit

## UI/UX Design

### Export Dialog
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üì§ Export Report                                          [X]  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  Report Type                                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ ‚óè District Summary Report                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚óã Submission Trends                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚óã Verification Funnel                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚óã Teacher Participation                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚óã Payout Summary                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚óã Fraud Analysis                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚óã Custom Report                                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Date Range                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  to  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ  ‚îÇ Nov 1, 2024     ‚îÇ      ‚îÇ Dec 7, 2024     ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Quick Select: [Last 7 Days] [Last 30 Days] [This Month]       ‚îÇ
‚îÇ                [Last Quarter] [Year to Date]                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Format                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ  ‚îÇ üìÑ PDF     ‚îÇ ‚îÇ üìä CSV     ‚îÇ ‚îÇ üìó Excel   ‚îÇ                  ‚îÇ
‚îÇ  ‚îÇ ‚úì Selected ‚îÇ ‚îÇ            ‚îÇ ‚îÇ            ‚îÇ                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Include in Report                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ [‚úì] Summary Statistics                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [‚úì] Charts and Visualizations                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [‚úì] Block-wise Breakdown                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [‚úì] Top Performers                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [ ] Individual Teacher Data                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [ ] Raw Transaction Data                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Delivery                                                       ‚îÇ
‚îÇ  ‚óã Download Now                                                 ‚îÇ
‚îÇ  ‚óè Email to: [admin@district.gov.in        ]                   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Schedule (Optional)                                            ‚îÇ
‚îÇ  [ ] Schedule recurring export                                  ‚îÇ
‚îÇ      Frequency: [Weekly ‚ñº]  Day: [Monday ‚ñº]                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                      Generate Report                        ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Export Progress
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üì§ Generating Report...                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 68%          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚úì Fetching submission data...                                 ‚îÇ
‚îÇ  ‚úì Aggregating statistics...                                   ‚îÇ
‚îÇ  ‚è≥ Generating charts...                                       ‚îÇ
‚îÇ  ‚óã Formatting PDF...                                           ‚îÇ
‚îÇ  ‚óã Finalizing report...                                        ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Estimated time remaining: 12 seconds                          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ                                              [Cancel]           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Technical Implementation

### Export Service
```javascript
// src/services/admin/ExportService.js

class ExportService {
  static REPORT_TYPES = {
    DISTRICT_SUMMARY: 'district_summary',
    SUBMISSION_TRENDS: 'submission_trends',
    VERIFICATION_FUNNEL: 'verification_funnel',
    TEACHER_PARTICIPATION: 'teacher_participation',
    PAYOUT_SUMMARY: 'payout_summary',
    FRAUD_ANALYSIS: 'fraud_analysis',
    CUSTOM: 'custom'
  };

  static FORMATS = {
    PDF: { extension: 'pdf', mimeType: 'application/pdf' },
    CSV: { extension: 'csv', mimeType: 'text/csv' },
    EXCEL: { extension: 'xlsx', mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }
  };

  static async generateReport(options) {
    const {
      reportType,
      districtId,
      startDate,
      endDate,
      format,
      includeCharts,
      includeSections,
      delivery
    } = options;

    const response = await fetch('/api/admin/reports/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        reportType,
        districtId,
        startDate: startDate.toISOString(),
        endDate: endDate.toISOString(),
        format,
        includeCharts,
        includeSections,
        delivery
      })
    });

    if (!response.ok) {
      throw new Error('Failed to generate report');
    }

    return response.json();
  }

  static async downloadReport(reportId) {
    const response = await fetch(`/api/admin/reports/${reportId}/download`);

    if (!response.ok) {
      throw new Error('Failed to download report');
    }

    const blob = await response.blob();
    const contentDisposition = response.headers.get('Content-Disposition');
    const filename = contentDisposition
      ? contentDisposition.split('filename=')[1].replace(/"/g, '')
      : `report-${reportId}.pdf`;

    return { blob, filename };
  }

  static async checkProgress(jobId) {
    const response = await fetch(`/api/admin/reports/progress/${jobId}`);
    return response.json();
  }

  static async scheduleReport(options) {
    const response = await fetch('/api/admin/reports/schedule', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(options)
    });

    return response.json();
  }

  static async getScheduledReports(districtId) {
    const response = await fetch(`/api/admin/reports/scheduled?districtId=${districtId}`);
    return response.json();
  }

  static async cancelScheduledReport(scheduleId) {
    const response = await fetch(`/api/admin/reports/schedule/${scheduleId}`, {
      method: 'DELETE'
    });
    return response.json();
  }

  // CSV generation for client-side export
  static generateCSV(data, columns) {
    const headers = columns.map(c => c.label).join(',');
    const rows = data.map(row =>
      columns.map(c => {
        const value = row[c.key];
        // Escape commas and quotes
        if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
          return `"${value.replace(/"/g, '""')}"`;
        }
        return value;
      }).join(',')
    );

    return [headers, ...rows].join('\n');
  }

  // Download blob helper
  static downloadBlob(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
}

export default ExportService;
```

### Export Dialog Component
```jsx
// src/components/admin/ExportDialog.jsx
import React, { useState } from 'react';
import ExportService from '../../services/admin/ExportService';

function ExportDialog({ districtId, onClose, defaultReportType }) {
  const [reportType, setReportType] = useState(defaultReportType || 'district_summary');
  const [dateRange, setDateRange] = useState({
    start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),
    end: new Date()
  });
  const [format, setFormat] = useState('PDF');
  const [includeSections, setIncludeSections] = useState({
    summary: true,
    charts: true,
    blockBreakdown: true,
    topPerformers: true,
    individualData: false,
    rawData: false
  });
  const [delivery, setDelivery] = useState('download');
  const [email, setEmail] = useState('');
  const [scheduleEnabled, setScheduleEnabled] = useState(false);
  const [schedule, setSchedule] = useState({ frequency: 'weekly', day: 'monday' });

  const [generating, setGenerating] = useState(false);
  const [progress, setProgress] = useState(null);
  const [error, setError] = useState(null);

  const handleQuickSelect = (preset) => {
    const end = new Date();
    let start = new Date();

    switch (preset) {
      case 'last7':
        start.setDate(end.getDate() - 7);
        break;
      case 'last30':
        start.setDate(end.getDate() - 30);
        break;
      case 'thisMonth':
        start = new Date(end.getFullYear(), end.getMonth(), 1);
        break;
      case 'lastQuarter':
        start.setMonth(end.getMonth() - 3);
        break;
      case 'ytd':
        start = new Date(end.getFullYear(), 0, 1);
        break;
    }

    setDateRange({ start, end });
  };

  const handleSectionToggle = (section) => {
    setIncludeSections(prev => ({
      ...prev,
      [section]: !prev[section]
    }));
  };

  const handleGenerate = async () => {
    setGenerating(true);
    setError(null);

    try {
      const result = await ExportService.generateReport({
        reportType,
        districtId,
        startDate: dateRange.start,
        endDate: dateRange.end,
        format,
        includeCharts: includeSections.charts,
        includeSections: Object.keys(includeSections).filter(k => includeSections[k]),
        delivery: delivery === 'email' ? { type: 'email', address: email } : { type: 'download' }
      });

      // Poll for progress
      const pollProgress = async () => {
        const progressData = await ExportService.checkProgress(result.jobId);
        setProgress(progressData);

        if (progressData.status === 'completed') {
          if (delivery === 'download') {
            const { blob, filename } = await ExportService.downloadReport(result.reportId);
            ExportService.downloadBlob(blob, filename);
          }
          setTimeout(onClose, 1000);
        } else if (progressData.status === 'failed') {
          setError('Report generation failed. Please try again.');
          setGenerating(false);
        } else {
          setTimeout(pollProgress, 1000);
        }
      };

      pollProgress();

      // Schedule if enabled
      if (scheduleEnabled) {
        await ExportService.scheduleReport({
          reportType,
          districtId,
          format,
          includeSections: Object.keys(includeSections).filter(k => includeSections[k]),
          schedule,
          email
        });
      }
    } catch (err) {
      setError(err.message);
      setGenerating(false);
    }
  };

  return (
    <div className="export-dialog-overlay">
      <div className="export-dialog">
        <header className="dialog-header">
          <h2>üì§ Export Report</h2>
          <button className="close-btn" onClick={onClose}>√ó</button>
        </header>

        {generating ? (
          <ExportProgress progress={progress} onCancel={onClose} />
        ) : (
          <div className="dialog-content">
            {/* Report Type */}
            <div className="form-section">
              <label>Report Type</label>
              <div className="radio-group">
                {Object.entries(ExportService.REPORT_TYPES).map(([key, value]) => (
                  <label key={key} className="radio-option">
                    <input
                      type="radio"
                      name="reportType"
                      value={value}
                      checked={reportType === value}
                      onChange={(e) => setReportType(e.target.value)}
                    />
                    {key.replace(/_/g, ' ')}
                  </label>
                ))}
              </div>
            </div>

            {/* Date Range */}
            <div className="form-section">
              <label>Date Range</label>
              <div className="date-inputs">
                <input
                  type="date"
                  value={dateRange.start.toISOString().split('T')[0]}
                  onChange={(e) => setDateRange(prev => ({ ...prev, start: new Date(e.target.value) }))}
                />
                <span>to</span>
                <input
                  type="date"
                  value={dateRange.end.toISOString().split('T')[0]}
                  onChange={(e) => setDateRange(prev => ({ ...prev, end: new Date(e.target.value) }))}
                />
              </div>
              <div className="quick-select">
                <button onClick={() => handleQuickSelect('last7')}>Last 7 Days</button>
                <button onClick={() => handleQuickSelect('last30')}>Last 30 Days</button>
                <button onClick={() => handleQuickSelect('thisMonth')}>This Month</button>
                <button onClick={() => handleQuickSelect('lastQuarter')}>Last Quarter</button>
                <button onClick={() => handleQuickSelect('ytd')}>Year to Date</button>
              </div>
            </div>

            {/* Format */}
            <div className="form-section">
              <label>Format</label>
              <div className="format-options">
                {['PDF', 'CSV', 'EXCEL'].map(f => (
                  <button
                    key={f}
                    className={`format-btn ${format === f ? 'selected' : ''}`}
                    onClick={() => setFormat(f)}
                  >
                    {f === 'PDF' ? 'üìÑ' : f === 'CSV' ? 'üìä' : 'üìó'} {f}
                  </button>
                ))}
              </div>
            </div>

            {/* Include Sections */}
            <div className="form-section">
              <label>Include in Report</label>
              <div className="checkbox-group">
                {Object.entries(includeSections).map(([key, value]) => (
                  <label key={key} className="checkbox-option">
                    <input
                      type="checkbox"
                      checked={value}
                      onChange={() => handleSectionToggle(key)}
                    />
                    {key.replace(/([A-Z])/g, ' $1').trim()}
                  </label>
                ))}
              </div>
            </div>

            {/* Delivery */}
            <div className="form-section">
              <label>Delivery</label>
              <div className="radio-group">
                <label className="radio-option">
                  <input
                    type="radio"
                    name="delivery"
                    value="download"
                    checked={delivery === 'download'}
                    onChange={() => setDelivery('download')}
                  />
                  Download Now
                </label>
                <label className="radio-option">
                  <input
                    type="radio"
                    name="delivery"
                    value="email"
                    checked={delivery === 'email'}
                    onChange={() => setDelivery('email')}
                  />
                  Email to:
                  <input
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    placeholder="email@example.com"
                    disabled={delivery !== 'email'}
                  />
                </label>
              </div>
            </div>

            {/* Schedule */}
            <div className="form-section">
              <label className="checkbox-option">
                <input
                  type="checkbox"
                  checked={scheduleEnabled}
                  onChange={(e) => setScheduleEnabled(e.target.checked)}
                />
                Schedule recurring export
              </label>
              {scheduleEnabled && (
                <div className="schedule-options">
                  <select
                    value={schedule.frequency}
                    onChange={(e) => setSchedule(prev => ({ ...prev, frequency: e.target.value }))}
                  >
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                  </select>
                  {schedule.frequency === 'weekly' && (
                    <select
                      value={schedule.day}
                      onChange={(e) => setSchedule(prev => ({ ...prev, day: e.target.value }))}
                    >
                      <option value="monday">Monday</option>
                      <option value="tuesday">Tuesday</option>
                      <option value="wednesday">Wednesday</option>
                      <option value="thursday">Thursday</option>
                      <option value="friday">Friday</option>
                    </select>
                  )}
                </div>
              )}
            </div>

            {error && <div className="error-message">{error}</div>}

            <button className="generate-btn" onClick={handleGenerate}>
              Generate Report
            </button>
          </div>
        )}
      </div>
    </div>
  );
}

function ExportProgress({ progress, onCancel }) {
  const steps = [
    { key: 'fetching', label: 'Fetching data...' },
    { key: 'aggregating', label: 'Aggregating statistics...' },
    { key: 'charts', label: 'Generating charts...' },
    { key: 'formatting', label: 'Formatting report...' },
    { key: 'finalizing', label: 'Finalizing report...' }
  ];

  return (
    <div className="export-progress">
      <div className="progress-bar">
        <div
          className="progress-fill"
          style={{ width: `${progress?.percentage || 0}%` }}
        />
      </div>
      <span className="progress-text">{progress?.percentage || 0}%</span>

      <div className="progress-steps">
        {steps.map((step, index) => {
          const currentIndex = steps.findIndex(s => s.key === progress?.currentStep);
          const status = index < currentIndex ? 'done' : index === currentIndex ? 'active' : 'pending';

          return (
            <div key={step.key} className={`step ${status}`}>
              <span className="step-icon">
                {status === 'done' ? '‚úì' : status === 'active' ? '‚è≥' : '‚óã'}
              </span>
              <span className="step-label">{step.label}</span>
            </div>
          );
        })}
      </div>

      {progress?.estimatedTime && (
        <p className="estimated-time">
          Estimated time remaining: {progress.estimatedTime} seconds
        </p>
      )}

      <button className="cancel-btn" onClick={onCancel}>Cancel</button>
    </div>
  );
}

export default ExportDialog;
```

## Dependencies

- **PDFKit/Puppeteer**: PDF generation
- **ExcelJS**: Excel export
- **Email service**: Report delivery

## Related Stories

- [DA-01](./DA-01.md) - Submission Trends (exportable)
- [DA-06](./DA-06.md) - Payout Summary (exportable)
- [SA-01](../state-admin/SA-01.md) - Statewide Metrics (exportable)

## Notes

- Large exports may be queued
- Scheduled exports help automate reporting
- Audit log tracks all exports for compliance
