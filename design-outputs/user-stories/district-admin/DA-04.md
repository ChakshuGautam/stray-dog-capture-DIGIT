# DA-04: View Leaderboard

[â† Back to User Stories Master](../../design-outputs/02-user-stories.md) | [â† Back to Admin Stories](./index.md)

## User Story

**As a** District Administrator,
**I want to** see a leaderboard of top-performing blocks and teachers,
**So that** I can recognize high performers and foster healthy competition.

## Description

Leaderboards create visibility and motivation for high performers while helping administrators identify teachers and blocks that can serve as examples for others.

## Acceptance Criteria

### Functional Requirements
- [ ] Block leaderboard showing top 10 blocks
- [ ] Teacher leaderboard showing top 20 teachers
- [ ] Rankings by: total submissions, verified rate, capture rate
- [ ] Time-based filtering (weekly, monthly, all-time)
- [ ] Anonymized teacher names (first name + last initial)
- [ ] Performance badges and streaks displayed
- [ ] Export for recognition ceremonies

### Non-Functional Requirements
- [ ] Updates daily at midnight
- [ ] Teacher privacy maintained
- [ ] Gamification elements to encourage participation

## UI/UX Design

### Leaderboard Dashboard
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ† Performance Leaderboard                      This Month     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [ Weekly ] [ Monthly* ] [ All Time ]                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ğŸ› TOP BLOCKS               â”‚  ğŸ‘©â€ğŸ« TOP TEACHERS            â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚                              â”‚                              â”‚â”‚
â”‚  â”‚  ğŸ¥‡ Patna City               â”‚  ğŸ¥‡ Priya S.          ğŸ”¥7   â”‚â”‚
â”‚  â”‚     423 submissions          â”‚     45 submissions           â”‚â”‚
â”‚  â”‚     92% verified rate        â”‚     100% verified            â”‚â”‚
â”‚  â”‚     â­â­â­â­â­                â”‚     â­â­â­â­â­               â”‚â”‚
â”‚  â”‚                              â”‚                              â”‚â”‚
â”‚  â”‚  ğŸ¥ˆ Danapur                  â”‚  ğŸ¥ˆ Rajesh K.         ğŸ”¥5   â”‚â”‚
â”‚  â”‚     298 submissions          â”‚     38 submissions           â”‚â”‚
â”‚  â”‚     89% verified rate        â”‚     97% verified             â”‚â”‚
â”‚  â”‚     â­â­â­â­                  â”‚     â­â­â­â­                 â”‚â”‚
â”‚  â”‚                              â”‚                              â”‚â”‚
â”‚  â”‚  ğŸ¥‰ Bikram                   â”‚  ğŸ¥‰ Anjali M.         ğŸ”¥12  â”‚â”‚
â”‚  â”‚     169 submissions          â”‚     35 submissions           â”‚â”‚
â”‚  â”‚     94% verified rate        â”‚     94% verified             â”‚â”‚
â”‚  â”‚     â­â­â­â­                  â”‚     â­â­â­â­                 â”‚â”‚
â”‚  â”‚                              â”‚                              â”‚â”‚
â”‚  â”‚  4. Phulwari - 187          â”‚  4. Mohammed A. - 32         â”‚â”‚
â”‚  â”‚  5. Sampatchak - 156        â”‚  5. Sunita D. - 31           â”‚â”‚
â”‚  â”‚  6. Maner - 112             â”‚  6. Vikram P. - 28           â”‚â”‚
â”‚  â”‚  7. Fatuha - 98             â”‚  7. Neha G. - 27             â”‚â”‚
â”‚  â”‚  8. Khusrupur - 87          â”‚  8. Amit S. - 26             â”‚â”‚
â”‚  â”‚  9. Masaurhi - 76           â”‚  9. Kavita R. - 25           â”‚â”‚
â”‚  â”‚  10. Pandarak - 65          â”‚  10. Ravi K. - 24            â”‚â”‚
â”‚  â”‚                              â”‚                              â”‚â”‚
â”‚  â”‚  [View All Blocks]          â”‚  [View Top 50]               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ğŸŒŸ Special Achievements This Month                        â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  ğŸ”¥ Longest Streak: Anjali M. (12 days consecutive)        â”‚â”‚
â”‚  â”‚  ğŸ“ˆ Most Improved: Bikram Block (+45% vs last month)       â”‚â”‚
â”‚  â”‚  âš¡ Fastest Growth: Sampatchak (+28 new teachers)          â”‚â”‚
â”‚  â”‚  ğŸ¯ Highest Quality: Priya S. (100% verification rate)     â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ğŸ“Š Ranking Criteria                                       â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  Score = (Verified Submissions Ã— 10) + (Capture Rate Ã— 5)  â”‚â”‚
â”‚  â”‚        + (Streak Bonus) - (Rejection Penalty)              â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  ğŸ”¥ Streak Bonus: +10% for 7+ consecutive days             â”‚â”‚
â”‚  â”‚  â­ Star Rating: Based on overall score percentile         â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚                          [Export for Recognition] [Print]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technical Implementation

### Leaderboard Service
```javascript
// src/services/admin/LeaderboardService.js

class LeaderboardService {
  static TIME_PERIODS = {
    WEEKLY: 7,
    MONTHLY: 30,
    ALL_TIME: null
  };

  static RANKING_WEIGHTS = {
    VERIFIED_SUBMISSIONS: 10,
    CAPTURE_RATE: 5,
    STREAK_BONUS: 0.10 // 10% bonus
  };

  static async getBlockLeaderboard(districtId, period, limit = 10) {
    const params = new URLSearchParams({
      districtId,
      period,
      limit: limit.toString()
    });

    const response = await fetch(`/api/admin/leaderboard/blocks?${params}`);
    return response.json();
  }

  static async getTeacherLeaderboard(districtId, period, limit = 20) {
    const params = new URLSearchParams({
      districtId,
      period,
      limit: limit.toString()
    });

    const response = await fetch(`/api/admin/leaderboard/teachers?${params}`);
    return response.json();
  }

  static async getSpecialAchievements(districtId, period) {
    const response = await fetch(
      `/api/admin/leaderboard/achievements?districtId=${districtId}&period=${period}`
    );
    return response.json();
  }

  static calculateScore(stats) {
    let score = stats.verifiedSubmissions * this.RANKING_WEIGHTS.VERIFIED_SUBMISSIONS;
    score += stats.captureRate * this.RANKING_WEIGHTS.CAPTURE_RATE;

    // Streak bonus
    if (stats.streakDays >= 7) {
      score *= (1 + this.RANKING_WEIGHTS.STREAK_BONUS);
    }

    // Rejection penalty
    score -= stats.rejectionRate * 2;

    return Math.round(score);
  }

  static getStarRating(percentile) {
    if (percentile >= 95) return 5;
    if (percentile >= 80) return 4;
    if (percentile >= 60) return 3;
    if (percentile >= 40) return 2;
    return 1;
  }

  static getRankIcon(rank) {
    const icons = { 1: 'ğŸ¥‡', 2: 'ğŸ¥ˆ', 3: 'ğŸ¥‰' };
    return icons[rank] || `${rank}.`;
  }

  static anonymizeTeacherName(fullName) {
    const parts = fullName.trim().split(' ');
    if (parts.length === 0) return 'Anonymous';
    const firstName = parts[0];
    const lastInitial = parts.length > 1 ? parts[parts.length - 1][0] + '.' : '';
    return `${firstName} ${lastInitial}`;
  }
}

export default LeaderboardService;
```

### Leaderboard Component
```jsx
// src/components/admin/LeaderboardDashboard.jsx
import React, { useState, useEffect } from 'react';
import LeaderboardService from '../../services/admin/LeaderboardService';

function LeaderboardDashboard({ districtId }) {
  const [period, setPeriod] = useState('MONTHLY');
  const [blockLeaderboard, setBlockLeaderboard] = useState([]);
  const [teacherLeaderboard, setTeacherLeaderboard] = useState([]);
  const [achievements, setAchievements] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchLeaderboards();
  }, [districtId, period]);

  const fetchLeaderboards = async () => {
    setLoading(true);
    try {
      const [blocks, teachers, specialAchievements] = await Promise.all([
        LeaderboardService.getBlockLeaderboard(districtId, period),
        LeaderboardService.getTeacherLeaderboard(districtId, period),
        LeaderboardService.getSpecialAchievements(districtId, period)
      ]);

      setBlockLeaderboard(blocks);
      setTeacherLeaderboard(teachers);
      setAchievements(specialAchievements);
    } catch (error) {
      console.error('Failed to fetch leaderboards:', error);
    } finally {
      setLoading(false);
    }
  };

  const exportForRecognition = () => {
    const data = {
      period,
      generatedAt: new Date().toISOString(),
      topBlocks: blockLeaderboard.slice(0, 3),
      topTeachers: teacherLeaderboard.slice(0, 10),
      achievements
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `leaderboard-${period.toLowerCase()}.json`;
    a.click();
  };

  if (loading) {
    return <div className="loading-spinner">Loading leaderboards...</div>;
  }

  return (
    <div className="leaderboard-dashboard">
      <header className="leaderboard-header">
        <h1>ğŸ† Performance Leaderboard</h1>
        <div className="period-tabs">
          {Object.keys(LeaderboardService.TIME_PERIODS).map(p => (
            <button
              key={p}
              className={`tab ${period === p ? 'active' : ''}`}
              onClick={() => setPeriod(p)}
            >
              {p === 'WEEKLY' ? 'Weekly' : p === 'MONTHLY' ? 'Monthly' : 'All Time'}
            </button>
          ))}
        </div>
      </header>

      <div className="leaderboard-grid">
        {/* Block Leaderboard */}
        <div className="leaderboard-card">
          <h2>ğŸ› Top Blocks</h2>
          <div className="leaderboard-list">
            {blockLeaderboard.map((block, index) => (
              <LeaderboardItem
                key={block.id}
                rank={index + 1}
                name={block.name}
                primaryStat={`${block.submissions} submissions`}
                secondaryStat={`${block.verifiedRate}% verified rate`}
                stars={block.stars}
              />
            ))}
          </div>
          <button className="view-all-btn">View All Blocks</button>
        </div>

        {/* Teacher Leaderboard */}
        <div className="leaderboard-card">
          <h2>ğŸ‘©â€ğŸ« Top Teachers</h2>
          <div className="leaderboard-list">
            {teacherLeaderboard.slice(0, 10).map((teacher, index) => (
              <LeaderboardItem
                key={teacher.id}
                rank={index + 1}
                name={LeaderboardService.anonymizeTeacherName(teacher.name)}
                primaryStat={`${teacher.submissions} submissions`}
                secondaryStat={`${teacher.verifiedRate}% verified`}
                stars={teacher.stars}
                streak={teacher.streakDays}
              />
            ))}
          </div>
          <button className="view-all-btn">View Top 50</button>
        </div>
      </div>

      {/* Special Achievements */}
      {achievements && (
        <div className="achievements-section">
          <h2>ğŸŒŸ Special Achievements This Month</h2>
          <div className="achievements-grid">
            {achievements.longestStreak && (
              <AchievementCard
                icon="ğŸ”¥"
                title="Longest Streak"
                winner={LeaderboardService.anonymizeTeacherName(achievements.longestStreak.name)}
                detail={`${achievements.longestStreak.days} days consecutive`}
              />
            )}
            {achievements.mostImproved && (
              <AchievementCard
                icon="ğŸ“ˆ"
                title="Most Improved"
                winner={achievements.mostImproved.name}
                detail={`+${achievements.mostImproved.improvement}% vs last month`}
              />
            )}
            {achievements.fastestGrowth && (
              <AchievementCard
                icon="âš¡"
                title="Fastest Growth"
                winner={achievements.fastestGrowth.name}
                detail={`+${achievements.fastestGrowth.newTeachers} new teachers`}
              />
            )}
            {achievements.highestQuality && (
              <AchievementCard
                icon="ğŸ¯"
                title="Highest Quality"
                winner={LeaderboardService.anonymizeTeacherName(achievements.highestQuality.name)}
                detail={`${achievements.highestQuality.verificationRate}% verification rate`}
              />
            )}
          </div>
        </div>
      )}

      {/* Ranking Criteria */}
      <div className="ranking-criteria">
        <h3>ğŸ“Š Ranking Criteria</h3>
        <p>
          Score = (Verified Submissions Ã— 10) + (Capture Rate Ã— 5) + (Streak Bonus) - (Rejection Penalty)
        </p>
        <div className="criteria-details">
          <span>ğŸ”¥ Streak Bonus: +10% for 7+ consecutive days</span>
          <span>â­ Star Rating: Based on overall score percentile</span>
        </div>
      </div>

      <div className="leaderboard-actions">
        <button onClick={exportForRecognition} className="export-btn">
          Export for Recognition
        </button>
        <button onClick={() => window.print()} className="print-btn">
          Print
        </button>
      </div>
    </div>
  );
}

function LeaderboardItem({ rank, name, primaryStat, secondaryStat, stars, streak }) {
  return (
    <div className={`leaderboard-item rank-${rank}`}>
      <div className="rank-icon">{LeaderboardService.getRankIcon(rank)}</div>
      <div className="item-info">
        <div className="item-name">
          {name}
          {streak && streak >= 7 && <span className="streak-badge">ğŸ”¥{streak}</span>}
        </div>
        <div className="item-stats">
          <span className="primary-stat">{primaryStat}</span>
          <span className="secondary-stat">{secondaryStat}</span>
        </div>
      </div>
      <div className="stars">
        {'â­'.repeat(stars)}
      </div>
    </div>
  );
}

function AchievementCard({ icon, title, winner, detail }) {
  return (
    <div className="achievement-card">
      <div className="achievement-icon">{icon}</div>
      <div className="achievement-title">{title}</div>
      <div className="achievement-winner">{winner}</div>
      <div className="achievement-detail">{detail}</div>
    </div>
  );
}

export default LeaderboardDashboard;
```

## Dependencies

- **DA-01**: Submission data
- **S-PTS**: Points system (streak tracking)

## Related Stories

- [DA-03](./DA-03.md) - Teacher Participation Rate
- [SA-02](../state-admin/SA-02.md) - Compare Districts
- [T-PAY-01](../teacher/T-PAY-01.md) - Points Balance

## Notes

- Teacher names are anonymized (first name + last initial)
- Gamification encourages healthy competition
- Export feature supports recognition ceremonies
- Streak tracking incentivizes consistent reporting
